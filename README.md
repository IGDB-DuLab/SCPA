# Single-cell-phenotype-analysis
##### This repository contains the source code used in our study titled "Defect-Buffering Cellular Plasticity Increases Robustness of Metazoan Embryogenesis". The provided scripts allow quantification and phenotypic determination of six types of developmental behaviors: cell cycle length, division asynchrony, division asymmetry, tissue marker expression, division angle, and relative cell position, following genetic perturbations. 
##### These scripts first process phenotypic information documented in a summary file following cell lineage tracing and tissue marker quantification using 3D time-lapse images of C. elegans embryogenesis. The lineage tracing summary (LTS) file lists the name, 3D coordinates, and fluorescence intensity of each traced nucleus at each traced time point. Then, based on comparing cellular phenotypes between control and gene knockdown (KD) embryos, the scripts determine which behavior of which cell is deviated significantly from the normal behavior to enable a single-cell multiplexed phenotypic analysis of embryogenesis. Finally, the scripts used to characterize the correction, alleviation, and accommodation of various cellular defects are also included.
## Description of files
##### The data folder provides example LTS files of both control and gene KD embryos for testing the utility of scripts. The LTS files of all analyzed embryos (files name with "raw_data") and corresponding 3D time-lapse image data (TIF files) are deposited and downloadable from the National Genomics Data Center of China https://ngdc.cncb.ac.cn/omix/release/OMIX709. 
## Description of scripts
##### Detailed instructions on how to import and export data are provided in the script.

## 1. The following scripts quantify various cellular behaviors using information documented in LTS files. 

### 01_proliferation.py
##### •	Input: LTS files 
##### •	Function: this script quantifies cell division timing and cell cycle length of each cell whose division was traced. This script outputs the cell cycle length and division timing of each cell.

### 02_expression.py
##### •	Input file: LTS files
##### •	Function: this script extracts and processes tissue marker (CND-1::GFP) expression data. This script outputs quantitative and binarized tissue marker expression in each traced cell.

### 03_distance_matrix.py
##### •	Input file: LTS files 
##### •	Function: this script extracts 3D coordinates of cells at the middle time of all traced time points, which are used to define the relative position of each cell as a vector of geometric distances between a cell of interest and all other cells at the same stage (reference cells), and then divided by the embryo length to normalize for size differences. Because nuclei are generally located in the centers of cells during early embryogenesis, nucleus positions are used to represent cell positions. It outputs pair-wise cell-cell distance matrix among all cells at representative developmental stages.

### 04_angle.py
##### •	Input: LTS files
##### •	Function: this script quantifies division angle formed by the cell division axis and the embryo’s anterior-posterior (A-P) axis. The angle was assigned a negative sign if the division axis pointed towards the side where the EMS cell localized, and positive if it pointed towards where the ABp cell localized at the 4-cell stage. Note: because cell position information is required for calculating the division angle, this script needs to be run after “03_distance_matrix.py". It outputs the division angle of each cell.

## 2. The following scripts compare various phenotypes of each cell between KD and control embryos to determine which cellular behaviors deviate significantly from normal embryos in which cells, using the output files generated by step 1.

### 05_proliferation_rate.py
##### •	Input: the division timing output files generated by 01_ proliferation.py; both KD and control embryos are required for the analysis
##### •	Function: this script determines whether the global rate of each KD embryo differed significantly from control embryos. It outputs the slope and associated q value of linear regression comparing cell division timing between KD and normal embryos
##### •	Note: as changes in the global proliferation rate could compromise the biological relevance of observed division asynchrony and asymmetry, we only considered phenotypic changes in KD embryos having a normal global proliferation rate (q > 0.01).

### 06_asynchrony_phenotype.py
##### •	Input: the division timing output files generated by 01_proliferation.py; both KD and control embryos are required for the analysis 
##### •	Function: this script compares division asynchrony in equivalent cells between KD and normal embryos and identifies cells with division asynchrony defects (0, normal; 1, abnormal). Also outputs are phenotype measurement (difference in the timing of cell division between cells at the same developmental stage (seven characteristic stages in total), and statistical results.  

### 07_asymmetry_phenotype.py
##### •	Input: division timing output files generated by 01_proliferation.py; both KD and control embryos are required for the analysis
##### •	Function: this script compares division asymmetry in equivalent cells between KD and normal embryos in equivalent cells and outputs cell pairs with division asynchrony defects (-1, smaller; 1, larger). Also outputs are phenotype measurement and statistical results. 

### 08_expression_phenotype.py
##### •	Input: binarized expression output file generated by 02_ expression.py; both KD and control embryos are required for the analysis
##### •	Function: this script compares the expression status of tissue marker (CND-1::GFP) in equivalent cells between KD and normal embryos and outputs cells with abnormal expression status (loss, -1; gain, 1). 

### 09_position_phenotype.py
##### •	Input: the output folder containing the cell-cell distance matrix files generated by 03_distance_matrix.py; both KD and control embryos are required for this analysis
##### •	Function: this script compares relative cell positions in equivalent cells between KD and normal embryos and outputs cells with abnormal cell positions (0, normal; 1, abnormal). Also outputs are phenotype measurement and statistical results.

### 10_other_phenotype.py
##### •	Input: For cell cycle length phenotype: cell cycle length or division timing output files generated by 01_proliferation.py; for division angle phenotype: division angle output files generated by 04_angle.py; both KD and control embryos are required for the analysis
##### •	Function: this script compares cell cycle length/division angle phenotypes in equivalent cells between KD and normal embryos and outputs cells with abnormal cycle length (-1, shorter; 1, longer) or cells with abnormal division angle (-1, smaller; 1, larger). Also outputs are phenotype measurement and statistical results.
## 3. The following scripts characterize defect correction, alleviation, coordination, and buffering 

### 11_asynchrony_alleviation.py
##### •	Input: division timing output files generated by 01_ proliferation.py, output files generated by 05_proliferation_rate.py, and output files generated by 06_ asynchrony_phenotype.py; both KD and control embryos are required for the analysis.
##### •	Function: this script estimates whether division asynchrony in daughter cells of mother cells that are identified as having division asynchrony defect is significantly closer to the wild-type value than expected (p < 0.05), taking into account differences propagated from the mother cell. Specifically, for a cell (X) with an abnormal division asynchrony in a KD embryo, the division timing of X in the KD embryo and the cell cycle length of X’s daughter (Y) in normal embryos were used to determine the expected division timing and division asynchrony of Y in the KD embryo. Then, the expected and observed division asynchrony of Y were compared to observations in normal embryos. If the observed division asynchrony is significantly closer than expected (p < 0.05) to that in normal embryos, a correction/alleviation of X’s defect in Y was identified. Similarity of division asynchrony was quantified using the RMSD of the two vectors representing the division timing differences between a target cell and all reference cells at the appropriate stage. This script outputs files statistics of the alleviation of abnormal division asynchrony similar to the table provided in Table S7 (Sheet 2) of our study. To ensure that division asynchrony measurements are biologically meaningful, we only considered cases in which less than 20% of cells exhibited the defect at corresponding daughter cell stages.

### 12_expression_compensation.py
##### •	Input: quantitative expression output files generated by 02_ expression.py and output files generated by 08_expression_phenotype.py
##### •	Function: this script checks that when loss of CND-1 expression is observed in intermediate cells of a CND-1 expression cell track, whether the protein was eventually present in corresponding traced terminal cells produced from that track. It outputs statistics of the compensation cases similar to the table provided in Table S7 (Sheet 3) of our study.

### 13_position_correction.py
##### •	Input: output files generated by 09_position_phenotype.py and output files generated by 03_distance_matrix.py
##### •	Function: this script determines whether a cell position defect in mother cells are disappeared in their daughter cells. In addition, it also estimates the chance of correction if the direction of cell displacement was randomized but the distance from mother to daughter cell remained constant. It outputs the cases consistent with defect correction and related statistics, similar to the table provided in Table S7 (Sheet 4) of our study.

### 14_expression_onset.py
##### •	Input file: LTS files, binary expression output files generated by 02_expression.py
##### •	Function: this script measures the expression onset of CND-1 protein in the earliest progenitor cells on the 18 CND-1 expression cell tracks. The onset of CND-1 expression was defined as the earliest time when the expression was above the calling threshold for at least three consecutive time points. It outputs the cells and expression onset time (The earliest time point of ABa/ABp cell division was set to time 0) of all expression cells on the 18 CND-1::GFP expression cell tracks. 

### 15_expression_division_coordination.py
##### •	Input file: division timing output files generated by 01_proliferation.py, binary expression output files generated by 02_expression.py, expression onset output files generated by 14_expression_onset.py, and division timing phenotype output files generated by 10_other_phenotype.py
##### •	Function: this script determines whether the expression onset of CND-1::GFP is coordinated with delayed cell division in the earliest progenitor cells on the 18 CND-1 expression cell tracks. It outputs the coordination status of each cell track in each KD embryo and related statistics.

### 16_cell_pair_distance_phenotype.py
##### •	Input file: cell-cell distance matrix output files generated by 03_distance_matrix.py; both KD and control embryos are required for this analysis.
##### •	Function: this script determines which cell-cell distance in a KD embryo deviates significantly from the value observed in the control embryos. It outputs a matrix detailing abnormal cell-cell distances (0, normal; 1, abnormal)

### 17_calculation_Facd.py
##### •	Input: the folder containing all output files generated by 16_cell_pair_distance_phenotype.py, phenotype calling output files generated by 09_position_phenotype.py, and the fate_clones.txt and positionally_related_cells.txt files provided in the “related file” folder.
##### •	Function: this script compares the frequency of abnormal cell-cell distances among all cell pairs (Facd) between cells within each fate clone, within each location cell cluster, and between unrelated cells. It outputs Facd values in corresponding cell groups and related statistics, similar to the table provided in Table S9 of our study. 

## Prerequisites
#### All analyses were performed under Python version:3.6.1
#### Additional Python packages required for analysis include:
##### Numpy version: 1.19.5
##### Pandas version: 0.20.1
##### Scipy version: 1.5.4
##### statsmodels version: 0.8.0
##### sympy version: 1.0
## Questions
##### For questions about the codes, please contact Long Xiao, email: xiaolong@genetics.ac.cn or xiaolong90523@163.com
## License
##### This project is licensed under the GNU General Public License v3.0 - see the LICENSE file for details.
